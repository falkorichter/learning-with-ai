import React, { useState, useEffect } from 'react';
import { BookOpen, HelpCircle, CheckCircle, XCircle, RefreshCw, ChevronRight, User } from 'lucide-react';

const VocabularyTrainer = () => {
  const [activeTab, setActiveTab] = useState('learn');
  
  // Vokabel-Datenbank
  const vocabCategories = {
    "Haare (Hair)": [
      { de: "blond", en: "blonde" },
      { de: "brunette / braunhaarig", en: "brunette" },
      { de: "rothaarig", en: "redhead / red-haired" },
      { de: "schwarze Haare", en: "black hair" },
      { de: "graue Haare", en: "grey hair" },
      { de: "glatt", en: "straight" },
      { de: "gewellt", en: "wavy" },
      { de: "lockig", en: "curly" },
      { de: "Glatze", en: "bald" },
      { de: "Pferdeschwanz", en: "ponytail" },
      { de: "Schulterlang", en: "shoulder-length" }
    ],
    "Gesicht & Augen (Face & Eyes)": [
      { de: "blaue Augen", en: "blue eyes" },
      { de: "braune Augen", en: "brown eyes" },
      { de: "grüne Augen", en: "green eyes" },
      { de: "haselnussbraune Augen", en: "hazel eyes" },
      { de: "Sommersprossen", en: "freckles" },
      { de: "Bart", en: "beard" },
      { de: "Schnurrbart", en: "mustache" },
      { de: "Falten", en: "wrinkles" },
      { de: "Brille", en: "glasses" },
      { de: "Muttermal", en: "mole" }
    ],
    "Hautfarbe & Teint (Complexion)": [
      { de: "blass / hell", en: "pale / fair" },
      { de: "gebräunt", en: "tanned" },
      { de: "dunkelhäutig", en: "dark-skinned" },
      { de: "hellhäutig", en: "light-skinned" },
      { de: "olivfarbener Teint", en: "olive skin" }
    ],
    "Körperbau & Statur (Build)": [
      { de: "groß", en: "tall" },
      { de: "klein", en: "short" },
      { de: "schlank", en: "slim / slender" },
      { de: "dünn", en: "thin" },
      { de: "pummelig / mollig", en: "plump / chubby" },
      { de: "übergewichtig", en: "overweight" },
      { de: "muskulös", en: "muscular" },
      { de: "durchschnittlich gebaut", en: "average build" },
      { de: "fit / gut gebaut", en: "fit / well-built" }
    ],
    "Alter (Age)": [
      { de: "jung", en: "young" },
      { de: "Mittelalt", en: "middle-aged" },
      { de: "alt / ältlich", en: "elderly / old" },
      { de: "Teenager", en: "teenager" },
      { de: "in den Zwanzigern", en: "in his/her twenties" }
    ]
  };

  // Hilfsfunktion: Alle Vokabeln in eine flache Liste für das Quiz
  const getAllVocabs = () => {
    let all = [];
    Object.values(vocabCategories).forEach(list => {
      all = [...all, ...list];
    });
    return all;
  };

  // Quiz State
  const [quizItem, setQuizItem] = useState(null);
  const [options, setOptions] = useState([]);
  const [selectedOption, setSelectedOption] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);
  const [score, setScore] = useState(0);
  const [attempts, setAttempts] = useState(0);

  // Neues Quiz generieren
  const generateQuestion = () => {
    const allVocabs = getAllVocabs();
    // Zufälliges Wort auswählen
    const randomTarget = allVocabs[Math.floor(Math.random() * allVocabs.length)];
    
    // 3 falsche Optionen auswählen
    let distractors = [];
    while (distractors.length < 3) {
      const randomDistractor = allVocabs[Math.floor(Math.random() * allVocabs.length)];
      if (randomDistractor.en !== randomTarget.en && !distractors.includes(randomDistractor)) {
        distractors.push(randomDistractor);
      }
    }

    // Mischen
    const quizOptions = [...distractors, randomTarget].sort(() => Math.random() - 0.5);

    setQuizItem(randomTarget);
    setOptions(quizOptions);
    setSelectedOption(null);
    setIsCorrect(null);
  };

  useEffect(() => {
    generateQuestion();
  }, []);

  const handleOptionClick = (option) => {
    if (selectedOption) return; // Verhindert mehrfaches Klicken

    setSelectedOption(option);
    const correct = option.en === quizItem.en;
    setIsCorrect(correct);
    
    setAttempts(attempts + 1);
    if (correct) {
      setScore(score + 1);
    }
  };

  const nextQuestion = () => {
    generateQuestion();
  };

  return (
    <div className="min-h-screen bg-slate-50 p-4 font-sans text-slate-800">
      <div className="max-w-md mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        
        {/* Header */}
        <div className="bg-indigo-600 p-6 text-white text-center">
          <h1 className="text-2xl font-bold flex items-center justify-center gap-2">
            <User className="w-8 h-8" />
            Appearance Vocab
          </h1>
          <p className="text-indigo-200 text-sm mt-1">Beschreibe, wie Menschen aussehen</p>
        </div>

        {/* Navigation Tabs */}
        <div className="flex border-b border-slate-200">
          <button
            onClick={() => setActiveTab('learn')}
            className={`flex-1 py-4 text-sm font-semibold flex items-center justify-center gap-2 transition-colors ${
              activeTab === 'learn' 
                ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50' 
                : 'text-slate-500 hover:text-indigo-600'
            }`}
          >
            <BookOpen className="w-4 h-4" />
            Lernen
          </button>
          <button
            onClick={() => setActiveTab('quiz')}
            className={`flex-1 py-4 text-sm font-semibold flex items-center justify-center gap-2 transition-colors ${
              activeTab === 'quiz' 
                ? 'text-indigo-600 border-b-2 border-indigo-600 bg-indigo-50' 
                : 'text-slate-500 hover:text-indigo-600'
            }`}
          >
            <HelpCircle className="w-4 h-4" />
            Quiz üben
          </button>
        </div>

        {/* Content Area */}
        <div className="p-6">
          
          {/* LEARN MODE */}
          {activeTab === 'learn' && (
            <div className="space-y-6">
              {Object.entries(vocabCategories).map(([category, items]) => (
                <div key={category} className="bg-slate-50 rounded-xl p-4 border border-slate-100">
                  <h3 className="text-indigo-600 font-bold text-lg mb-3 border-b border-slate-200 pb-2">
                    {category}
                  </h3>
                  <div className="grid grid-cols-1 gap-2">
                    {items.map((item, idx) => (
                      <div key={idx} className="flex justify-between items-center bg-white p-2 rounded shadow-sm">
                        <span className="text-slate-600 font-medium">{item.de}</span>
                        <ChevronRight className="w-4 h-4 text-slate-300" />
                        <span className="text-indigo-700 font-bold">{item.en}</span>
                      </div>
                    ))}
                  </div>
                </div>
              ))}
            </div>
          )}

          {/* QUIZ MODE */}
          {activeTab === 'quiz' && quizItem && (
            <div className="text-center space-y-6">
              
              <div className="flex justify-between items-center text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">
                <span>Score: {score}</span>
                <span>Fragen: {attempts}</span>
              </div>

              <div className="py-8">
                <span className="block text-slate-500 text-sm mb-2">Wie sagt man auf Englisch:</span>
                <h2 className="text-3xl font-extrabold text-slate-800 animate-in fade-in slide-in-from-bottom-4 duration-500">
                  "{quizItem.de}"?
                </h2>
              </div>

              <div className="grid gap-3">
                {options.map((option, idx) => {
                  let btnClass = "w-full p-4 rounded-xl text-left font-semibold transition-all duration-200 border-2 ";
                  
                  if (selectedOption) {
                    if (option.en === quizItem.en) {
                      btnClass += "bg-green-100 border-green-500 text-green-800 shadow-md"; // Richtige Antwort immer grün anzeigen
                    } else if (selectedOption === option && option.en !== quizItem.en) {
                      btnClass += "bg-red-100 border-red-500 text-red-800"; // Falsch gewählt
                    } else {
                      btnClass += "bg-slate-50 border-slate-200 text-slate-400 opacity-50"; // Nicht gewählte
                    }
                  } else {
                    btnClass += "bg-white border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 text-slate-700 shadow-sm hover:shadow-md";
                  }

                  return (
                    <button
                      key={idx}
                      onClick={() => handleOptionClick(option)}
                      disabled={selectedOption !== null}
                      className={btnClass}
                    >
                      <div className="flex items-center justify-between">
                        <span>{option.en}</span>
                        {selectedOption && option.en === quizItem.en && <CheckCircle className="w-5 h-5 text-green-600"/>}
                        {selectedOption === option && option.en !== quizItem.en && <XCircle className="w-5 h-5 text-red-600"/>}
                      </div>
                    </button>
                  );
                })}
              </div>

              {selectedOption && (
                <div className="pt-4 animate-in fade-in zoom-in duration-300">
                  <button
                    onClick={nextQuestion}
                    className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-all"
                  >
                    <RefreshCw className="w-5 h-5" />
                    Nächste Frage
                  </button>
                </div>
              )}
            </div>
          )}

        </div>
      </div>
    </div>
  );
};

export default VocabularyTrainer;
